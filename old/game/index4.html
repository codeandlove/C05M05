<html>
<head>
<title>My first Three.js app</title>
<style>
	*{margin:0;padding:0;}
	body{background:#000;}
	canvas { width: 100%; height: 100% }
</style>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
</head>
<body>

<script src="js/Three.js"></script>
<script src="js/TrackballControls.js"></script>
<script id="vertexshader" type="x-shader/x-vertex">

	uniform float amplitude;
	
	attribute float displacement;
	varying vec3 vNormal;
	
	void main() {
		vNormal = normal;
		vec3 newPosition = position + 
						   normal * 
						   vec3(displacement*amplitude);

		gl_Position = projectionMatrix *
					  modelViewMatrix *
					  vec4(newPosition,1.0);
	}
		
</script>
<script id="fragmentshader" type="x-shader/x-fragment">

	varying vec3 vNormal;
	
	void main() {
		vec3 light = vec3(0.0,0.0,1.0);
		light = normalize(light);
		float dProd = max(0.0, dot(vNormal, light));
		gl_FragColor = vec4(dProd, dProd, dProd, 1.0);
	}
	
</script>

<script>

	var objects = [], scene, camera, renderer, trackBallControls;
	var noise = [];
	var mouseX, mouseY;
	var sphere, uniforms, attributes, light,light2, lightSphere;
	
	function init(){
		scene = new THREE.Scene();
		camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 100000);
		renderer = new THREE.WebGLRenderer({ antialias: true } );
		
		renderer.setSize(window.innerWidth, window.innerHeight);
		document.body.appendChild(renderer.domElement);
		
		camera.position.z=500;
		
		attributes = {
			displacement: {
				type: 'f', // a float
				value: [] // an empty array
			}
		};
		uniforms = {
			amplitude: { type: 'f', value: 0 },
			color: { type: "c", value: new THREE.Color( 0xff0000 ) }
			/*texture: { type: "t", value: THREE.ImageUtils.loadTexture( "textures/water.jpg" ) }, */
		};
		
		var shaderMaterial = new THREE.ShaderMaterial({
			attributes:     attributes,
			uniforms:     	uniforms,
			lights: false,
			vertexShader:   document.getElementById( 'vertexshader' ).textContent,
			fragmentShader: document.getElementById( 'fragmentshader' ).textContent,
		});
		
		var radius = 50, segments = 128, rings = 64;
		var geometry = new THREE.SphereGeometry( radius, segments, rings );
		sphere = new THREE.Mesh(geometry,shaderMaterial);
		scene.add(sphere); 
		
		var vertices = sphere.geometry.vertices;
		var values = attributes.displacement.value
		for(var v = 0; v < vertices.length; v++) {
			values.push(Math.random() * 10);
		}
		
		lightSphere = new THREE.Mesh(new THREE.SphereGeometry( 10, 5, 5 ),new THREE.MeshBasicMaterial(0xffffff));
		lightSphere.position.set( 0, 0, 0 );
		scene.add( lightSphere );
		lightSphere.visible = false;
		light = new THREE.PointLight( 0xff0000, 1, 100 );
		scene.add( light );
		
		light2 = new THREE.AmbientLight( 0xff0000 );
		scene.add( light2 );
		
		trackBallControls = new THREE.TrackballControls( camera, renderer.domElement );
		
		trackBallControls.rotateSpeed = 1.0;
		trackBallControls.zoomSpeed = 1.2;
		trackBallControls.panSpeed = 0.8;
		trackBallControls.noZoom = false;
		trackBallControls.noPan = false;
		trackBallControls.staticMoving = false;
		trackBallControls.dynamicDampingFactor = 0.5; 

	}
	var frame = 0;
	function render(){
		requestAnimationFrame(render);
		renderer.render( scene, camera ); 
		trackBallControls.update()
		lightSphere.position.x += Math.sin(frame)*10;
		lightSphere.position.z += Math.cos(frame)*10;
		light.position.copy(lightSphere);
		
		uniforms.amplitude.value = Math.sin(frame);
		frame += 0.01;
	}
	init();
	render();
	
</script>
</body>
</html>